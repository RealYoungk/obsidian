> 스터디 종목 현재 상황과 성과 추이

## 📊 스터디 종목 현황

```dataviewjs
const studyStocks = dv.pages('#스터디종목')
    .where(p => p.file.path.includes('1. 기업분석'))
    .sort(p => p.file.name);

if (!studyStocks || studyStocks.length === 0) {
    dv.paragraph("⚠️ 스터디 종목이 없습니다.");
} else {
    // 최신 스냅샷 파일 찾기
    const snapshotFiles = dv.pages('"0. 대시보드/주가스냅샷"')
        .where(p => p.file.name.includes('주가스냅샷_'))
        .sort(p => p.file.name, 'desc');
    
    if (snapshotFiles.length === 0) {
        dv.paragraph("⚠️ 스냅샷 데이터가 없습니다.");
        return;
    }
    
    const latestSnapshot = snapshotFiles[0];
    const snapshotContent = await dv.io.load(latestSnapshot.file.path);
    
    // 스터디 종목만 필터링해서 테이블 생성
    let table = [];
    
    for (let stock of studyStocks) {
        // 기본 정보 추출
        const companyName = stock.file.name;
        const ticker = stock.ticker;
        const targetCap = stock.목표시가총액 || 'N/A';
        const targetDate = stock.목표시점 || 'N/A';
        
        // 스냅샷에서 해당 기업 정보 찾기
        const companySection = snapshotContent.match(new RegExp(`## ${companyName}[\\s\\S]*?(?=## |$)`, 'g'));
        
        if (companySection && companySection[0]) {
            const section = companySection[0];
            
            // 현재가 추출 (₩ 또는 $ 형태)
            const priceMatch = section.match(/\*\*현재가\*\*:\s*([₩$][\d,$.()₩\s]+)/);
            const currentPrice = priceMatch ? priceMatch[1].trim() : 'N/A';
            
            // 시가총액 추출
            const marketCapMatch = section.match(/\*\*시가총액\*\*:\s*([^-\n]+)/);
            const marketCap = marketCapMatch ? marketCapMatch[1].trim() : 'N/A';
            
            // 1년 성과 추출
            const yearMatch = section.match(/1년:\s*([^→]+)\s*→\s*([^(]+)\s*\(([^)]+)\)/);
            const yearPerformance = yearMatch ? `${yearMatch[3]}` : 'N/A';
            
            // 상승 여력 계산 (목표시가총액이 있는 경우)
            let upside = 'N/A';
            if (targetCap !== 'N/A' && marketCap !== 'N/A') {
                try {
                    let currentCapNum, targetCapNum;
                    
                    if (marketCap.includes('조')) {
                        currentCapNum = parseFloat(marketCap.replace(/[조\s]/g, ''));
                    } else if (marketCap.includes('천억')) {
                        currentCapNum = parseFloat(marketCap.replace(/[천억\s]/g, '')) / 10;
                    } else if (marketCap.includes('$') && marketCap.includes('B')) {
                        currentCapNum = parseFloat(marketCap.replace(/[$B\s]/g, '')) * 1330 / 1000000;
                    } else if (marketCap.includes('$') && marketCap.includes('M')) {
                        currentCapNum = parseFloat(marketCap.replace(/[$M\s]/g, '')) * 1330 / 1000000000;
                    }
                    
                    if (targetCap.includes('조')) {
                        targetCapNum = parseFloat(targetCap.replace(/[조\s]/g, ''));
                    }
                    
                    if (currentCapNum && targetCapNum) {
                        const upsidePercent = ((targetCapNum - currentCapNum) / currentCapNum * 100).toFixed(1);
                        upside = `${upsidePercent}%`;
                    }
                } catch (e) {
                    upside = 'Error';
                }
            }
            
            table.push([
                `[[${companyName}]]`,
                ticker,
                currentPrice,
                marketCap,
                targetCap,
                targetDate,
                upside,
                yearPerformance
            ]);
        } else {
            // 스냅샷에 데이터가 없는 경우
            table.push([
                `[[${companyName}]]`,
                ticker,
                'N/A',
                'N/A',
                targetCap,
                targetDate,
                'N/A',
                'N/A'
            ]);
        }
    }
    
    dv.table([
        "기업명", 
        "티커", 
        "현재가", 
        "시가총액",
        "목표시가총액",
        "목표시점",
        "상승여력",
        "1년 성과"
    ], table);
    
    // 업데이트 시간 표시
    dv.paragraph(`*마지막 업데이트: ${latestSnapshot.file.name.replace('주가스냅샷_', '').replace('.md', '')}*`);
}
```

## 📈 스터디 종목 성과 분석

```dataviewjs
// 최근 스냅샷들을 이용한 성과 분석
const snapshotFiles = dv.pages('"0. 대시보드/주가스냅샷"')
    .where(p => p.file.name.includes('주가스냅샷_'))
    .sort(p => p.file.name, 'desc')
    .limit(5); // 최근 5개 스냅샷

if (snapshotFiles.length > 0) {
    // 스터디 종목 태그가 있는 기업들 조회
    const studyStocks = dv.pages('#스터디종목')
        .where(p => p.file.path.includes('1. 기업분석'))
        .sort(p => p.file.name);
    
    dv.header(3, "최근 성과 요약");
    
    for (let stock of studyStocks) {
        const stockName = stock.file.name;
        const latestSnapshot = snapshotFiles[0];
        const content = await dv.io.load(latestSnapshot.file.path);
        
        const companySection = content.match(new RegExp(`## ${stockName}[\\s\\S]*?(?=## |$)`, 'g'));
        
        if (companySection && companySection[0]) {
            const section = companySection[0];
            
            // 각 기간별 성과 추출
            const weekMatch = section.match(/1주일:[^(]*\(([^)]+)\)/);
            const monthMatch = section.match(/1개월:[^(]*\(([^)]+)\)/);
            const sixMonthMatch = section.match(/6개월:[^(]*\(([^)]+)\)/);
            const yearMatch = section.match(/1년:[^(]*\(([^)]+)\)/);
            
            dv.paragraph(`**${stockName}**: 1주일 ${weekMatch?.[1] || 'N/A'} | 1개월 ${monthMatch?.[1] || 'N/A'} | 6개월 ${sixMonthMatch?.[1] || 'N/A'} | 1년 ${yearMatch?.[1] || 'N/A'}`);
        }
    }
} else {
    dv.paragraph("⚠️ 스냅샷 데이터가 없습니다.");
}
```

---
*스터디 종목: 집중 연구 및 투자 검토 대상 종목들*